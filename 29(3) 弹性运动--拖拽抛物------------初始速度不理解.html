<!doctype html>
<html lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<title>Document</title>
	<meta name="Keywords" content="" />
	<meta name="Description" content="" />
	<style>
		* {
			margin:0px;
			padding:0px;
		}
		.box {
			width:100px;
			height:100px;
			background:red;
			position:absolute;
		}
	</style>
</head>
<body>
	<div class="box" id="box"></div>
	<script>
		window.onload = function(){
			var boxDom = document.getElementById("box");
			var mark = false;
			var timer = null;
			var speedy = 0;
			var speedx = 10;
			var dy = 0;
			var dx = 0;
			boxDom.onmousedown = function(e){
				var l = this.offsetLeft;
				var t = this.offsetTop;
				var mark = true;
				var maxH = window.innerHeight - this.offsetHeight;
				var maxW = window.innerWidth - this.offsetWidth;
				var pos1 = getXY(e);
				//dy = pos1.y;
				//dx = pos1.x;
				document.onmousemove = function(e){
					var pos2 = getXY(e);
					var nl = pos2.x - pos1.x + l;
					var nt = pos2.y - pos1.y + t;
					if(nl<=0)nl = 0;
					if(nt<=0)nt = 0;
					if(nl>=maxW)nl = maxW;
					if(nt>=maxH)nt = maxH;
					boxDom.style.top = nt + "px";
					boxDom.style.left = nl + "px";
					speedy = pos2.y - dy;
					speedx = pos2.x - dx;
					dy = pos2.y;
					dx = pos2.x;
					//console.log(speedy+"=="+dy+"==="+dx+"==="+speedx+"=="+pos2.y+"==="+pos2.x);
				};
				document.onmouseup = function(){
					document.onmousemove = null;
					document.onmouseup = null;
					mark = false;
					//alert(speedy+"=="+dy+"==="+dx+"==="+speedx);
					move();
				};
			};

			// 元素自由落体
			window.onresize = move;
			function move(){
				clearInterval(timer);
				timer = setInterval(function(){
					speedy += 10;
					var y = boxDom.offsetTop + speedy;
					var x = boxDom.offsetLeft + speedx;
					var mH = window.innerHeight - boxDom.offsetHeight;
					var mW = window.innerWidth - boxDom.offsetWidth;
					if(y>mH){
						y = mH;
						speedy*=-1;
						speedy*=0.825;
						speedx*=0.625;
					}else if(y < 0){
						y = 0;
						speedy*=-1;
						speedy*=0.825;
					}

					if(x>mW){
						x = mW;
						speedx*=-1;
						speedx*=0.625;
						
					}else if(x <0){
						x = 0;
						speedx*=-1;
						speedx*=0.625;
					}


					if(Math.abs(speedx.toFixed(2))<=0.01){
						speedy = 0;
						speedx = 10;
						clearInterval(timer);
					}else{
						boxDom.style.top = y + "px";
						boxDom.style.left = x + "px";
					}
				},30);
			}
		};
		// 获取鼠标点坐标
		function getXY(e){
			var e = e || window.event;
			var x = 0,y = 0;
			if(e.pageX){
				x = e.pageX;
				y = e.pageY;
			}else{
				var scrollTop = 0,scrollLeft = 0;
				if(document.documentElement){
					scrollTop = document.documentElement.scrollTop;
					scrollLeft = document.documentElement.scrollLeft;
				}else{
					scrollTop = document.body.scrollTop;
					scrollLeft = document.body.scrollLeft;
				}
				x = e.clientX + scrollLeft;
				y = e.clientY + scrollTop;
			}
			return {x:x,y:y};
		}
	</script>
</body>
</html>
